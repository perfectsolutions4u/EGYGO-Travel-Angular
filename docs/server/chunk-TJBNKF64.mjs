import './polyfills.server.mjs';
import{a as F}from"./chunk-GR3J6XBL.mjs";import{a as E}from"./chunk-3QQ5QWEE.mjs";import{Ca as C,Ec as M,Fc as O,Ga as n,Gb as s,Ha as m,Hb as v,Ib as p,Pb as _,Rb as g,Tb as S,Wb as b,Xa as f,Xb as R,Y as w,Za as l,ad as k,bd as P,db as y,ib as r,jb as a,kb as u,rb as x,xc as T,yc as I}from"./chunk-JRUE2OIN.mjs";var h=o=>["/tour",o],D=(o,c,t)=>({"fa-heart":!0,"text-danger":o,"fa-regular":c,"fa-solid":t});function z(o,c){o&1&&(r(0,"span",6),s(1,"featured"),a())}function A(o,c){if(o&1&&(r(0,"span"),u(1,"i",22),a()),o&2){let t=c.$implicit;n(),l("ngClass",t?"fa fa-star text-warning":"fa-regular fa-star text-warning")}}var U=(()=>{class o{constructor(t,i,e){this._DataService=t,this.toaster=i,this._Router=e,this.layoutType="grid",this.favs=[],this.favouriteIds=[],this.alltours=[],this.tourReviews=[]}ngOnInit(){if(typeof window<"u"&&typeof localStorage<"u"){let t=localStorage.getItem("favouriteIds");this.favouriteIds=t?JSON.parse(t):[]}else console.warn("localStorage is not available (probably SSR mode)");this.tour?.id&&this.getTourReviews()}addFav(t,i){if(i.stopPropagation(),!localStorage.getItem("accessToken")){this.toaster.error("You must have an account"),this._Router.navigate(["/login"]);return}this._DataService.toggleWishlist(t).subscribe({next:e=>{if(localStorage.getItem("accessToken")){this.favs=e;let d=this.favouriteIds.indexOf(t);d>-1?this.favouriteIds.splice(d,1):this.favouriteIds.push(t),localStorage.setItem("favouriteIds",JSON.stringify(this.favouriteIds))}else this.toaster.error("You must have an account ")},error:e=>{this.toaster.error(e.error.message)}})}getTourReviews(){this.tour?.id&&this._DataService.getReviews(this.tour.id).subscribe({next:t=>{this.tourReviews=t.data.data||[]},error:t=>{console.error("Error fetching reviews:",t),this.tourReviews=[]}})}getStars(t){let i=Math.max(0,Math.min(5,Math.floor(t||0)));return Array.from({length:5},(e,d)=>d<i)}getAverageRating(){return this.tourReviews.length===0?this.tour?.rate||0:this.tourReviews.reduce((i,e)=>i+(e.rate||0),0)/this.tourReviews.length}getReviewQualityText(){if((this.tourReviews.length||this.tour?.reviews_number||0)===0)return"New Tour";let i=this.getAverageRating();return i>=4.5?"Excellent":i>=4?"Very Good":i>=3.5?"Good":i>=3?"Average":i>0?"Below Average":"No Rating"}getReviewCount(){return this.tourReviews.length||this.tour?.reviews_number||0}getDestinationText(){return this.tour?.destinationsTitle?this.tour.destinationsTitle:this.tour?.destinations&&Array.isArray(this.tour.destinations)&&this.tour.destinations.length>0?this.tour.destinations.map(t=>t.title).join(", "):"Destination not specified"}static{this.\u0275fac=function(i){return new(i||o)(m(E),m(F),m(k))}}static{this.\u0275cmp=w({type:o,selectors:[["app-tour-cart"]],inputs:{layoutType:"layoutType",tour:"tour"},standalone:!0,features:[_],decls:37,vars:30,consts:[["role","button",1,"item","p-3","rounded-3","overflow-hidden","sideBar","transition",3,"routerLink","ngClass"],[1,"px-0",3,"ngClass"],[1,"rounded-2","overflow-hidden","position-relative"],["height","200px","loading","lazy",1,"w-100",3,"src","alt","title"],[1,"secBtn","Btn","border-0","position-absolute","top-0","end-0","p-0","m-2","rounded-circle",3,"click"],[1,"fa","fa-heart","bg-transparent",3,"ngClass"],[1,"text-uppercase","text-whit","py-0","px-2","m-1","m-2","secBtn","Btn","position-absolute","top-0","start-0"],[1,"caption","text-white","rounded-top-3","position-absolute","bottom-0","py-1","px-2","text-center"],[1,"fa","fa-location-dot","me-1"],[1,"mx-2"],[1,"fa","fa-calendar-days","me-1"],[1,"",3,"ngClass"],[1,"my-2"],[4,"ngFor","ngForOf"],[1,"textMainColor","text-capitalize","mx-2"],[1,"textSecondColor"],[1,"text-capitalize","transition","cPointer",3,"routerLink"],[1,"textSecondColor","py-2","border-top","flexBetween","flex-wrap","flex-column","text-capitalize"],[1,"mb-0","flexBetween","w-100"],[1,"textMainColor","fs-5"],[1,"secBtn","Btn","w-100",3,"routerLink"],[1,"fa","fa-arrow-right","ms-1","rounded-circle"],[3,"ngClass"]],template:function(i,e){i&1&&(r(0,"div",0)(1,"div",1)(2,"figure",2),u(3,"img",3),r(4,"button",4),x("click",function(B){return e.addFav(e.tour.id,B)}),u(5,"i",5),a(),f(6,z,2,0,"span",6),r(7,"div",7)(8,"span"),u(9,"i",8),s(10),a(),r(11,"span",9),s(12,"|"),a(),r(13,"span"),u(14,"i",10),s(15),a()()()(),r(16,"div",11)(17,"figcaption")(18,"div",12),f(19,A,2,1,"span",13),r(20,"span",14),s(21),a(),r(22,"span",15),s(23),a()(),r(24,"h3",16),s(25),a(),r(26,"div",17)(27,"p",18)(28,"span"),s(29,"per person from:"),a(),u(30,"br"),r(31,"b",19),s(32),b(33,"currency"),a()(),r(34,"button",20),s(35," see more "),u(36,"i",21),a()()()()()),i&2&&(l("routerLink",g(20,h,e.tour.slug))("ngClass",e.layoutType==="grid"?"row gx-3 flex-column":"row gx-3 flex-wrap"),n(),l("ngClass",e.layoutType==="grid"?"":" col-md-5"),n(2),l("src",e.tour.featured_image,C)("alt",e.tour.title)("title",e.tour.title),n(2),l("ngClass",S(22,D,e.favouriteIds.includes(e.tour.id),!e.favouriteIds.includes(e.tour.id),e.favouriteIds.includes(e.tour.id))),n(),y(6,e.tour.featured?6:-1),n(4),p(" ",e.getDestinationText()," "),n(5),p(" ",e.tour.duration," "),n(),l("ngClass",e.layoutType==="grid"?"":" col-md-7"),n(3),l("ngForOf",e.getStars(e.tour.rate)),n(2),v(e.getReviewQualityText()),n(2),p(" (",e.getReviewCount()," Reviews)"),n(),l("routerLink",g(26,h,e.tour.slug)),n(),p(" ",e.tour.title," "),n(7),v(R(33,18,e.tour.start_from)),n(2),l("routerLink",g(28,h,e.tour.slug)))},dependencies:[P,O,T,I,M],styles:[".item[_ngcontent-%COMP%]:hover{transform:translateY(5px) scale(1.01)}.item[_ngcontent-%COMP%]:hover   figure[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{background-color:#592566}.item[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{background-color:#0e726c;left:5%;width:90%;transition:all .7s ease-in-out;font-size:13px!important}.item[_ngcontent-%COMP%]   figcaption[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#592566;height:60px;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;overflow:hidden;-webkit-box-orient:vertical;font-size:20px}.item[_ngcontent-%COMP%]   figcaption[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:hover{color:#0e726c}"]})}}return o})();export{U as a};
